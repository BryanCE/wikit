# Task 2.2: Create MCP Server Structure

## Purpose

Set up the file structure for the MCP server with entry points and tool organization.

## Files to Create

### 1. src/index.ts - Entry Point

This is the main entry point that will be called by Claude Desktop or other MCP clients.

```typescript
#!/usr/bin/env node
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { createMCPServer } from "./server.js";
import type { WikiConfig } from "@bryance/wikit/types";
import * as dotenv from "dotenv";

// Load environment variables
dotenv.config();

// Load config (adjust based on your actual config structure)
const config: WikiConfig = {
  primary: {
    url: process.env.WIKI_PRIMARY_URL!,
    apiKey: process.env.WIKI_PRIMARY_API_KEY!,
  },
  secondary: process.env.WIKI_SECONDARY_URL
    ? {
        url: process.env.WIKI_SECONDARY_URL,
        apiKey: process.env.WIKI_SECONDARY_API_KEY!,
      }
    : undefined,
};

async function main() {
  const server = await createMCPServer(config);
  const transport = new StdioServerTransport();
  await server.connect(transport);
  console.error("Wikit MCP server running on stdio");
}

main().catch((error) => {
  console.error("Fatal error:", error);
  process.exit(1);
});
```

### 2. src/server.ts - Server Logic

This file will contain the MCP server setup and tool definitions (will be expanded in Task 2.4).

```typescript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";
import type { WikiConfig } from "@bryance/wikit/types";

export async function createMCPServer(config: WikiConfig) {
  const server = new Server(
    {
      name: "wikit-mcp",
      version: "0.1.0",
    },
    {
      capabilities: {
        tools: {},
      },
    }
  );

  // Tool handlers will be added in Task 2.4

  return server;
}
```

### 3. src/tools/ Directory

This directory will hold individual tool implementations (will be created in Task 2.4):

- `search-pages.ts` - Search for pages
- `get-page.ts` - Get page content
- `list-pages.ts` - List all pages
- `get-navigation.ts` - Get navigation tree
- `get-status.ts` - Get wiki status

For now, just create the directory:

```bash
mkdir -p src/tools
```

### 4. Add Shebang to Entry Point

The `#!/usr/bin/env node` at the top of src/index.ts is important - it tells the system to use Node.js to run this file.

## Directory Structure

After this task:

```
wikit-mcp/
├── src/
│   ├── index.ts          # Entry point with config
│   ├── server.ts         # MCP server setup
│   └── tools/            # Tool implementations (empty for now)
├── package.json
├── tsconfig.json
└── ...
```

## Key Concepts

### Entry Point (index.ts)
- Loads environment variables
- Creates config object
- Initializes server
- Connects to stdio transport

### Server (server.ts)
- Creates MCP Server instance
- Registers tool handlers
- Returns configured server

### Tools (tools/)
- Individual tool implementations
- Import wikit commands
- Handle MCP tool calls

## Verification

- [ ] src/index.ts created with shebang
- [ ] src/server.ts created
- [ ] src/tools/ directory exists
- [ ] Imports reference @bryance/wikit correctly
- [ ] TypeScript types imported correctly

## Next Steps

Move to Task 2.3 to configure package.json for the MCP server.
